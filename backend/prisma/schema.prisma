datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id             Int             @id @default(autoincrement())
  mobile         String          @unique
  isVerified     Boolean         @default(false)
  role           UserRole        @default(USER)
  createdAt      DateTime        @default(now())
  pran           String?
  refreshToken   String?
  onboardingStep OnboardingStep  @default(MOBILE_VERIFIED)
  kycStatus      KycStatus       @default(NOT_STARTED)

  kyc            Kyc?
  profile        UserProfile?
  consents       Consent[]
  pfmSelection   PfmSelection?
  events         AnalyticsEvent[]
  documents      Document[]
  payments       Payment[]
  videoSessions  VideoKycSession[]
}

model Kyc {
  id               Int             @id @default(autoincrement())
  userId           Int             @unique
  aadhaarVerified  Boolean         @default(false)
  aadhaarLast4     String?
  name             String?
  dob              DateTime?
  gender           String?
  panVerified      Boolean         @default(false)
  panNumber        String?
  ckycFound        Boolean         @default(false)
  videoKycStatus   VideoKycStatus  @default(INITIATED)

  user             User            @relation(fields: [userId], references: [id])
}

model UserProfile {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  fatherName     String?
  maritalStatus  String?
  occupation     String?
  annualIncome   Int?
  address        String?
  nomineeName    String?

  user           User     @relation(fields: [userId], references: [id])
}

model Consent {
  id          Int      @id @default(autoincrement())
  userId      Int
  consentType String
  timestamp   DateTime @default(now())
  ipAddress   String

  user        User     @relation(fields: [userId], references: [id])
}

model PfmSelection {
  id          Int    @id @default(autoincrement())
  userId      Int    @unique
  pfmId       Int
  allocationE Float?
  allocationC Float?
  allocationG Float?
  allocationA Float?

  user        User   @relation(fields: [userId], references: [id])
}

model AnalyticsEvent {
  id        Int      @id @default(autoincrement())
  eventType String
  userId    Int?
  timestamp DateTime @default(now())
  details   Json?

  user      User?    @relation(fields: [userId], references: [id])
}

model Document {
  id        Int            @id @default(autoincrement())
  userId    Int
  type      String
  path      String
  status    DocumentStatus @default(PENDING)
  verified  Boolean        @default(false)

  user      User           @relation(fields: [userId], references: [id])
}

model Payment {
  id        Int           @id @default(autoincrement())
  userId    Int
  orderId   String        @unique
  amount    Int
  status    PaymentStatus @default(CREATED)
  createdAt DateTime      @default(now())

  user      User          @relation(fields: [userId], references: [id])
}

model VideoKycSession {
  id        Int               @id @default(autoincrement())
  userId    Int
  sessionId String            @unique
  status    VideoKycStatus    @default(INITIATED)
  createdAt DateTime          @default(now())

  user      User              @relation(fields: [userId], references: [id])
}

enum OnboardingStep {
  MOBILE_VERIFIED
  KYC_PENDING
  KYC_COMPLETED
  PROFILE_COMPLETED
  PFM_SELECTED
  PAYMENT_COMPLETED
  PRAN_GENERATED
}

enum KycStatus {
  NOT_STARTED
  AADHAAR_INITIATED
  AADHAAR_VERIFIED
  PAN_PENDING
  PAN_VERIFIED
  VIDEO_REQUIRED
  REJECTED
  APPROVED
}

enum DocumentStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum PaymentStatus {
  CREATED
  SUCCESS
  FAILED
}

enum VideoKycStatus {
  INITIATED
  APPROVED
  REJECTED
}

enum UserRole {
  USER
  ADMIN
}
